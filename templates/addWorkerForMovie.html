<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>addWorkerForMovie</title>
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css">
    {% load static %}
	<link type="text/css" rel="stylesheet" href="{% static "css/topicCreatingPage.css" %}">
    <script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
    <script src="http://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/axios/0.21.1/axios.min.js"></script>

</head>
<body>
<div id="movieAdding">
    <button v-on:click="toMovieAddingPage()">向影人库新增影人</button>
    <form method="get">

    <label><input name="type" type="radio" value="director" checked/>导演 </label>
    <label><input name="type" type="radio" value="writer" />编剧 </label>
    <label><input name="type" type="radio" value="actor" />演员 </label>
            <br/><br/><br/>
    </form>

<input placeholder="请输入新增影人的姓名:)" id="worker_name">
<button v-on:click="searchWorkerByName()">搜索</button>

    <div v-if="this.show == true">
        <form method="get">
            <ul>
                <li v-for="worker in workers">
                    <label><input name="id" type="radio" v-bind:value="worker.worker_id" checked/>
                    <img v-bind:src="worker.worker_picture">
                    </label>
                </li>
            </ul>
<!--    <label><input name="type" type="radio" value="writer" />编剧 </label>-->
<!--    <label><input name="type" type="radio" value="actor" />演员 </label>-->
            <br/><br/><br/>
    </form>
    <button v-on:click="addWorkerForMovie()">添加影人</button>
    </div>
</div>
<script>
    var vm = new Vue({
        el:"#movieAdding",
        delimiters:["[[","]]"],
        data:{
            name: '',
            type: '',
            introduction: '',
            workers: [],
            id: '',
            show: false
        },
        methods:{
            searchWorkerByName(){
                this.name = document.getElementById('worker_name').value
                console.log(this.name)
                axios.get("{% url 'searchWorkerByName' %}",{
                    params:{
                        worker_name: this.name
                    }
                }).then(response=>{
                    this.workers = response.data
                    this.show = true
                }),err=>{
                    console.log(err);
                };
            },
            addWorkerForMovie(){
                this.id = $("input[name='id']:checked").val()
                this.type = $("input[name='type']:checked").val()
                console.log(this.id)
                axios.get("{% url 'addWorkerToMovie' %}",{
                    params:{
                        worker_id: this.id,
                        type: this.type,
                        film_id: sessionStorage.getItem("film_id")
                    }
                }).then(response=>{
                    alert("影人添加成功！")
                }),err=>{
                    console.log(err);
                };
            },
           toMovieAddingPage() {
                window.location.href = "{% url 'movieAddingPage' %}"
            }
        }
    })
</script>
</body>
</html>